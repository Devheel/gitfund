#! /usr/bin/env python2

# Public Domain (-) 2017 The GitFund Authors.
# See the GitFund UNLICENSE file for details.

"""Script to create the prices.py and prices.js files."""

from json import dumps as encode_json
from os.path import abspath, dirname, join

from plandata import (
    DETAILED_DEFAULT, DETAILED_DEFAULT_JS, INDEX, INDEX_JS, PRICES, PRICES_JS,
    PRICES_POS, PRICES_JS_POS, TERRITORY2TAX
)

TERRITORY2TAX = {
    territory: prefix
    for (territory, (prefix, _)) in TERRITORY2TAX.items()
}

def generate_prices_js(path):
    print "Writing:", path
    f = open(path, 'wb'); out = f.write
    out("// DO NOT EDIT\n")
    out("// AUTOGENERATED BY GENPRICES\n\n")
    out("DETAILED_DEFAULT = ")
    out(encode_json(DETAILED_DEFAULT_JS, indent=2))
    out(";\n\n")
    out("PRICES_INDEX = ")
    out(encode_json(INDEX_JS, sort_keys=True, indent=2))
    out(";\n\n")
    out("PRICES_POS = ")
    out(encode_json(PRICES_JS_POS, sort_keys=True, indent=2))
    out(";\n\n")
    out("TERRITORY2PRICES = ")
    out(encode_json(PRICES_JS, sort_keys=True, indent=2))
    out(";\n\n")
    out("TERRITORY2TAX = ")
    out(encode_json(TERRITORY2TAX, sort_keys=True, indent=2))
    out(";\n\n")
    f.close()

def generate_prices_py(path):
    print "Writing:", path
    f = open(path, 'wb'); out = f.write
    out("# encoding: utf-8\n\n")
    out("# DO NOT EDIT\n")
    out("# AUTOGENERATED BY GENPRICES\n\n")
    out("DETAILED_DEFAULT = [\n")
    for elem in DETAILED_DEFAULT:
        out("  %r,\n" % elem)
    out("]\n\n")
    out("PRICES_INDEX = [\n")
    for elem in INDEX:
        out("  %r,\n" % elem)
    out("]\n\n")
    out("PRICES_POS = {\n")
    for slot, pos in sorted(PRICES_POS.items()):
        out("  '%s': %d,\n" % (slot, pos))
    out("}\n\n")
    out("TERRITORY2PRICES = {\n")
    for territory, pos in sorted(PRICES.items()):
        out("  '%s': %d,\n" % (territory, pos))
    out("}\n")
    f.close()

root_dir = dirname(dirname(dirname(abspath(__file__))))
generate_prices_js(join(root_dir, 'private', 'mvp', 'js', 'prices.js'))
generate_prices_py(join(root_dir, 'private', 'mvp', 'prices.py'))
